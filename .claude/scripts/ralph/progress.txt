# Ralph Progress Log
Started: 2024-01-15

## Codebase Patterns
- Migrations: IF NOT EXISTS
- Types: Export from actions.ts
- Tiptap Extensions: Import using named imports from @tiptap/extension-* packages
- React State: Use separate state for HTML content when converting from markdown
- Next.js Imports: Use @/ alias for src/ directory imports
- Tiptap History: Disable StarterKit history and use custom History extension for depth configuration

## Key Files
- db/schema.ts
- app/auth/actions.ts
- src/components/Editor/TiptapEditor.tsx
- src/lib/utils/markdownToHtml.ts
- src/app/cotizacion-estructurada/resultado/[id]/page.tsx
---

## 2026-01-25 - US-001
- Implemented base Tiptap editor setup with all required extensions
- Files changed: package.json, src/components/Editor/TiptapEditor.tsx
- **Learnings:**
  - Tiptap extensions must be imported as named imports, not default imports
  - Project uses src/ directory structure for components
  - StarterKit extension provides basic editor functionality
  - Extensions: Table, TableRow, TableCell, TableHeader, TextAlign, Underline
---

## 2026-01-25 - US-002
- Implemented markdownToHtml() function for converting Firestore markdown to HTML for Tiptap
- Files changed: package.json, src/lib/utils/markdownToHtml.ts
- **Learnings:**
  - marked library provides reliable markdown to HTML conversion with GFM support
  - marked.setOptions() accepts gfm: true for table support
  - marked.parse() returns string when called synchronously
  - Function handles edge cases: empty content, special characters (ñ, acentos)
  - Testing confirmed proper structure preservation: headers, tables, lists, bold, italic
  - Utils functions belong in src/lib/utils/ directory
---

## 2026-01-25 - US-003
- Replaced ReactMarkdown with TiptapEditor in resultado page for editable preview
- Files changed: src/app/cotizacion-estructurada/resultado/[id]/page.tsx
- **Learnings:**
  - TiptapEditor component accepts content and onChange props for real-time updates
  - markdownToHtml() converts Firestore markdown to HTML automatically on load
  - Editor container uses sistema de diseño: bg-white border border-gray-200/50 rounded-[16px] shadow-sm
  - State management: separate editorContent state tracks HTML while quotation keeps original markdown
  - Import paths use @/ alias for src/ directory components and utilities
  - Next.js build and lint pass with warnings but no errors
---

## 2026-01-25 - US-004
- Implemented Toolbar component with Bold, Italic, Underline buttons for formatting text
- Files changed: src/components/Editor/Toolbar.tsx, src/components/Editor/TiptapEditor.tsx
- **Learnings:**
  - Tiptap editor commands use `editor.chain().focus().toggleMark('markName').run()` syntax for formatting
  - Button active states checked with `editor.isActive('markName')` for visual feedback
  - Toolbar integrates seamlessly with TiptapEditor by passing editor instance as prop
  - Design system classes: w-10 h-10 border border-gray-200 rounded-lg for icon buttons
  - Active state styling: bg-blue-50 border-blue-600 text-blue-600 
  - Lucide React icons (Bold, Italic, Underline) work well for toolbar buttons
  - Keyboard shortcuts (Cmd+B, Cmd+I, Cmd+U) work automatically with StarterKit and Underline extensions
  - Tooltips added via title attribute for accessibility
---

## 2026-01-25 - US-005
- Implemented HeadingDropdown component with Párrafo, Título 1, Título 2, Título 3 options
- Files changed: src/components/Editor/HeadingDropdown.tsx, src/components/Editor/Toolbar.tsx, .claude/scripts/ralph/prd.json
- **Learnings:**
  - Tiptap heading detection: `editor.isActive('heading', { level: 1 })` checks for specific heading level
  - Tiptap heading commands: `editor.chain().focus().toggleHeading({ level })` switches to heading level
  - Tiptap paragraph command: `editor.chain().focus().setParagraph()` converts back to paragraph
  - Dropdown state management: useState for isOpen, click outside overlay to close dropdown
  - Design system: rounded-full for dropdown trigger, shadow-2xl rounded-xl p-1.5 for dropdown menu
  - Active state styling: bg-blue-50 text-blue-600 font-medium for current selection
  - ChevronDown icon from Lucide React works well for dropdown indicator
---

## 2026-01-25 - US-006
- Implemented bullet and numbered list buttons in Toolbar with full functionality
- Files changed: src/components/Editor/Toolbar.tsx, src/app/globals.css, .claude/scripts/ralph/prd.json
- **Learnings:**
  - Tiptap StarterKit includes BulletList and OrderedList extensions by default
  - List commands: `editor.chain().focus().toggleBulletList().run()` and `editor.chain().focus().toggleOrderedList().run()`
  - List active states: `editor.isActive('bulletList')` and `editor.isActive('orderedList')`
  - Tab/Shift+Tab indentation and Enter navigation work automatically with StarterKit
  - CSS styling: Added .tiptap-editor ul/ol styles in globals.css with text-sm text-gray-700
  - List icons: Lucide React List and ListOrdered icons work well for toolbar buttons
  - Nested list styling: margin control needed for proper indentation appearance
---

## 2026-01-25 - US-007
- Implemented Undo and Redo buttons in Toolbar with keyboard shortcuts and disabled states
- Files changed: src/components/Editor/Toolbar.tsx, src/components/Editor/TiptapEditor.tsx, package.json, .claude/scripts/ralph/prd.json
- **Learnings:**
  - Tiptap undo/redo commands: `editor.chain().focus().undo().run()` and `editor.chain().focus().redo().run()`
  - Undo/redo availability check: `editor.can().undo()` and `editor.can().redo()` for disabled state
  - History extension configuration: Install @tiptap/extension-history, disable StarterKit history, configure depth: 100
  - Disabled button styling: disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed 
  - Keyboard shortcuts (Cmd+Z, Cmd+Shift+Z) work automatically with History extension
  - Lucide React icons: Undo2 and Redo2 work well for undo/redo toolbar buttons
  - Extension dependencies: Must install missing Tiptap extensions via npm before using
---

## 2026-01-25 - US-008
- Implemented text alignment buttons (left, center, right, justify) in Toolbar with active state indication
- Files changed: src/components/Editor/Toolbar.tsx, .claude/scripts/ralph/prd.json
- **Learnings:**
  - Tiptap text alignment commands: `editor.chain().focus().setTextAlign('left|center|right|justify').run()`
  - Text alignment active state: `editor.isActive({ textAlign: 'alignment' })` for specific alignment detection
  - TextAlign extension already included from initial setup in US-001, no additional packages needed
  - Alignment works on paragraphs and headers as specified
  - Lucide React alignment icons: AlignLeft, AlignCenter, AlignRight, AlignJustify work well
  - Active state styling consistent: bg-blue-50 border-blue-600 text-blue-600
  - Tooltips: Spanish text for user-facing interface (Alinear a la izquierda, Centrar texto, etc.)
---

## 2026-01-25 - US-009
- Implemented table cell text editing functionality with full styling and navigation
- Files changed: src/app/globals.css, src/components/Editor/TiptapEditor.tsx, .claude/scripts/ralph/prd.json
- **Learnings:**
  - Tiptap Table extensions (Table, TableRow, TableCell, TableHeader) provide cell editing by default
  - Table extension resizable: true enables column resizing capabilities
  - CSS styling: table border-gray-200 rounded-xl for design system compliance
  - Header cells: bg-gray-50 text-xs font-semibold uppercase text-gray-500 px-4 py-3
  - Data cells: px-4 py-3 text-gray-600 border-b border-gray-200 text-sm
  - Tab/Shift+Tab navigation works automatically with Tiptap table extensions
  - Click positioning in cells works by default, cursor: text styling improves UX
  - Text formatting (bold, italic, underline) works inside table cells without additional config
  - StarterKit history configuration requires "as any" type assertion to avoid TS errors
---